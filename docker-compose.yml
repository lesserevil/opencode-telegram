services:
  ytbot:
    build:
      context: .
      dockerfile: Dockerfile
    container_name: ytbot
    restart: unless-stopped

    # Volumes for persistent data
    volumes:
      # .env file - must exist before starting container
      # Mounted as read-only to /app/.env where npx ytbot expects it
      - ./.env:/app/.env:ro

      # Logs directory - persists bot logs
      - ./logs:/app/logs

      # Media downloads directory - where YouTube videos are temporarily stored
      # Using named volume for better Docker management and cleanup
      - ytbot_downloads:/tmp/ytBOT_media

      # Alternative: Use bind mount to access downloads on host
      # - ./downloads:/tmp/ytBOT_media

    # Resource limits - adjust based on your server capacity
    deploy:
      resources:
        limits:
          cpus: "2.0" # Maximum 2 CPU cores
          memory: 2G # Maximum 2GB RAM
        reservations:
          cpus: "0.25" # Minimum 0.25 CPU cores
          memory: 256M # Minimum 256MB RAM

    # Security options
    security_opt:
      - no-new-privileges:true # Prevent privilege escalation

    # Logging configuration
    logging:
      driver: "json-file"
      options:
        max-size: "10m" # Maximum log file size
        max-file: "3" # Keep last 3 log files

    # Health check - verifies bot is running
    healthcheck:
      test: ["CMD", "node", "-e", "process.exit(0)"]
      interval: 60s
      timeout: 10s
      retries: 3
      start_period: 30s

# Named volumes
volumes:
  ytbot_downloads:
    driver: local
    # Optional: Use driver options for specific mount points
    # driver_opts:
    #   type: none
    #   o: bind
    #   device: /path/on/host/downloads
